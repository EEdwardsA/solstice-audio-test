<html>
<title>"Bucket Brigade" Audio Demo</title>
<style>
body {
  max-width: 40em;
}
.warning {
  border: 1px solid red;
  max-width: 30em;
  margin: 1em;
  padding: 1em;
}
#clapAlong {
  display: none;
}
#runningInstructions {
  display: none;
}
#mainApp {
  display: none;
}
#estQuality {
  background: #eee;
  border-radius: 1em;
  padding: 5em;
  margin: 1em;
  width: calc(100vw - 4em);
  box-sizing: border-box;
}
#est40to60 {
  font-size: 400%;
}
#estLatency {
  font-size: 200%;
}
#startButton, #muteButton {
  font-size: 200%;
}
#activeUsers {
  margin-left: 1em;
}
#chatWindow {
  margin: 1em;
  background: #eee;
}
#chatDisplay {
  padding: 0.25em;
  height: 15em;
  overflow-y: scroll;
}
#chatPost {
  width: 3em;
}
.chatName {
  font-style: italic;
}
#chatEntry {
  width: calc(100% - 3em);
}
#errorBox {
  display: none;
}
</style>
<h1>"Bucket Brigade" Audio Demo</h1>

<div class=warning>

This is a prototype, currently only works in Chrome, and there is only
one active instance. Please be kind! If you're a programmer, I would
recommend opening up devtools so you can see if there are any
interesting console messages.

</div>

Enter your name and press enter:
  <input id=userName></input>

<div id=mainApp>

Input device:
  <select id=inSelect disabled=true>
    <option>Loading...</option>
  </select>
<br>
  Output device:
  <select id=outSelect disabled=true>
    <option>Loading...</option>
  </select>

<p>

<div class=warning id=errorBox></div>

<button id=startButton></button>
<button id=muteButton disabled=true>Mute</button>

<p>

<div id=clapAlong>

You should be hearing some clicks. Clap along, on the beat. This will
let the system estimate your latency.  If you don't hear anything, try
changing your output device above.  If the system is not registering
your clamps, try to change your input device.

<p>

  <div id=estQuality>
    <center>
    <span id=est40to60>...</span><br>
    variance<br>
    <br>

    <span id=estLatency>...</span><br>
    latency<br>
    <br>

    <span id=estSamples>...</span><br>
    #claps
    </center>
  </div>

<p>

Click volume: <input id=clickVolumeSlider type=range min=0 max=100
value=85>

</div>

<div id=runningInstructions>

You're calibrated now!  Everyone is in one big long chain, and your
audio offset chooses where you are in that chain. If you use a smaller
number, more people will be able to hear you, well if you use a larger
number you will be able to hear more people.  We recommend using
multiples of 10 seconds to space people out.  Discuss over chat to
figure out what offsets people should use.

<p>

Audio offset (seconds):
<input type=text id=audioOffset value="28">

<p>

<h4>Active Users</h4>

<table id=activeUsers></table>

<h4>Chat</h4>
<div id=chatWindow>
  <div id=chatDisplay></div>
  <input id=chatEntry></input><button id=chatPost>Post</button>
</div>

<button id=takeLead>Take Lead Position</button>

</div>

<br>
<br>
<br>
<br>
<br>
<br>

<hr>

<h3>

(<a href="full-instructions.html">background</a>)

<br>

<button type="button" data-otherlabel="Close debug settings" class="collapse">Open debug settings</button>
<div style="display:none">
    Loopback mode:
    <select id=loopbackMode>
      <option value=none selected>None (default)</option>
      <option value=worklet>Inside worklet process()</option>
      <option value=main>In main app thread</option>
      <option value=server>Server-side</option>
    </select>
  <br>
    Server path:
    <input type=text id=serverPath value="/api/">
  <br>
    Console log level:
    <select id=logLevel></select>
  <div id=clickParams>(Clicks BPM if selected: <input type=text id=clickBPM value=60>)</div>
</div>
<h3>Debug info:</h3>
  Sample rate:
  <input type=text id=sampleRate value="(not available yet)" disabled>
<br>
  Input / output peak absolute amplitude:
  <input type=text id=peakIn value="(not available yet)" disabled>
  <input type=text id=peakOut value="(not available yet)" disabled>
<br>
  This client total time consumed (s):
  <input type=text id=clientTotalTime value="(not available yet)" disabled>
<br>
  This client read slippage (s):
  <input type=text id=clientReadSlippage value="(not available yet)" disabled>
<br>
  Batch size (ms):
  <input type=text id=msBatchSize value="(not available yet)" disabled>
<br>
<br>

</div>

<div id="secretCrap" style="display:none">
  <!--<span id=hamiltonAudioSpan><audio src="hamilton.mp3" preload=true></audio></span>-->
  <span id=outputAudioSpan><audio id=outputAudio></audio></span>
</div>

<script type="module" src="./app.js"></script>
</html>
